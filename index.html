<!DOCTYPE html>
<html>
<head>
    <title>‚ö° Quick Fake GPS Detector</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            width: 100%;
            max-width: 450px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .timer {
            text-align: center;
            font-size: 48px;
            font-weight: 800;
            color: #2D8CFF;
            margin: 20px 0;
            font-family: monospace;
        }
        
        .btn {
            background: linear-gradient(135deg, #2D8CFF, #0066CC);
            color: white;
            border: none;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 15px;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
            transition: all 0.2s;
            box-shadow: 0 5px 20px rgba(42, 139, 242, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(42, 139, 242, 0.5);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
        }
        
        .result {
            margin-top: 25px;
            padding: 25px;
            border-radius: 15px;
            background: #f8f9fa;
            border: 2px solid #2D8CFF;
            display: none;
        }
        
        .result-real {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .result-fake {
            border-color: #dc3545;
            background: #f8d7da;
        }
        
        .result h3 {
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .check-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 10px 0;
            background: white;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        
        .check-status {
            font-size: 24px;
            font-weight: bold;
        }
        
        .check-good { color: #28a745; }
        .check-bad { color: #dc3545; }
        .check-warning { color: #ffc107; }
        
        .coordinates {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #2D8CFF;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .copy-btn {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
            border: none;
            padding: 15px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            font-weight: 600;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #ffc107;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff416c, #ff4b2b, #ffc107, #28a745);
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° FAKE GPS DETECTOR</h1>
            <p>30-Second Real Location Verification</p>
        </div>
        
        <div class="content">
            <div class="timer" id="timer">30s</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
            
            <button class="btn" id="scanBtn" onclick="startFakeGPSCheck()">
                ‚ö° START 30-SECOND CHECK
            </button>
            
            <div class="warning">
                <strong>üéØ What we check:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Fake GPS app detection</li>
                    <li>VPN/Proxy masking</li>
                    <li>Impossible accuracy levels</li>
                    <li>Suspicious coordinate patterns</li>
                </ul>
            </div>
            
            <div id="result" class="result"></div>
        </div>
    </div>

    <script>
    // Global variables
    let scanTimeout = null;
    let timeLeft = 30;
    let isScanning = false;
    
    // Start the fake GPS check
    async function startFakeGPSCheck() {
        if (isScanning) return;
        
        isScanning = true;
        timeLeft = 30;
        
        // Update UI
        const btn = document.getElementById('scanBtn');
        btn.innerHTML = '<span class="loading"></span> SCANNING...';
        btn.disabled = true;
        
        // Clear previous results
        document.getElementById('result').style.display = 'none';
        document.getElementById('result').innerHTML = '';
        
        // Start timer
        updateTimer();
        
        // Start all checks in parallel
        const checks = await Promise.all([
            checkForFakeGPS(),
            checkIPLocation(),
            checkForVPN(),
            checkCoordinatesPattern()
        ]);
        
        // Analyze results
        const analysis = analyzeFakeGPS(checks);
        
        // Show results
        showResults(analysis, checks);
        
        // Reset
        isScanning = false;
        btn.innerHTML = '‚ö° START 30-SECOND CHECK';
        btn.disabled = false;
    }
    
    // Timer function
    function updateTimer() {
        const timerElement = document.getElementById('timer');
        const progressElement = document.getElementById('progress');
        
        if (timeLeft > 0 && isScanning) {
            timeLeft--;
            timerElement.textContent = timeLeft + 's';
            progressElement.style.width = ((30 - timeLeft) / 30 * 100) + '%';
            
            // Change progress color based on time
            if (timeLeft > 20) {
                progressElement.style.background = '#ff416c';
            } else if (timeLeft > 10) {
                progressElement.style.background = '#ffc107';
            } else {
                progressElement.style.background = '#28a745';
            }
            
            setTimeout(updateTimer, 1000);
        }
    }
    
    // CHECK 1: Fake GPS Detection
    async function checkForFakeGPS() {
        return new Promise((resolve) => {
            const checks = {
                hasAltitude: false,
                hasSpeed: false,
                hasHeading: false,
                accuracy: null,
                isSuspicious: false,
                reasons: []
            };
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const coords = position.coords;
                    
                    // Check 1: Perfect accuracy (common in fake GPS)
                    if (coords.accuracy < 2) {
                        checks.isSuspicious = true;
                        checks.reasons.push(`Perfect accuracy: ${coords.accuracy}m (Fake GPS apps often show <2m)`);
                    }
                    
                    // Check 2: No altitude data (common in fake GPS)
                    if (coords.altitude === null || coords.altitude === 0) {
                        checks.isSuspicious = true;
                        checks.reasons.push('No altitude data (Real GPS always has altitude)');
                    } else {
                        checks.hasAltitude = true;
                    }
                    
                    // Check 3: No speed/heading data (common in fake GPS)
                    if (coords.speed === null) {
                        checks.isSuspicious = true;
                        checks.reasons.push('No speed data (Real GPS has movement data)');
                    } else {
                        checks.hasSpeed = true;
                    }
                    
                    if (coords.heading === null) {
                        checks.reasons.push('No heading data');
                    } else {
                        checks.hasHeading = true;
                    }
                    
                    // Check 4: Multiple readings consistency
                    setTimeout(() => {
                        navigator.geolocation.getCurrentPosition(
                            (secondPosition) => {
                                const distance = calculateDistance(
                                    coords.latitude, coords.longitude,
                                    secondPosition.coords.latitude, secondPosition.coords.longitude
                                );
                                
                                // Real GPS has small variations, fake GPS is often static
                                if (distance < 1 && coords.accuracy < 5) {
                                    checks.isSuspicious = true;
                                    checks.reasons.push(`GPS completely static (${distance.toFixed(2)}m movement - too perfect)`);
                                }
                                
                                checks.accuracy = coords.accuracy;
                                checks.position = position;
                                resolve(checks);
                            },
                            () => resolve(checks),
                            { enableHighAccuracy: true, timeout: 5000 }
                        );
                    }, 3000);
                },
                (error) => {
                    checks.isSuspicious = true;
                    checks.reasons.push(`GPS error: ${error.message}`);
                    resolve(checks);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        });
    }
    
    // CHECK 2: IP Location vs GPS
    async function checkIPLocation() {
        try {
            const response = await fetch('https://ipapi.co/json/');
            const ipData = await response.json();
            
            // Get GPS location for comparison
            const gpsPosition = await new Promise((resolve) => {
                navigator.geolocation.getCurrentPosition(resolve, () => resolve(null), { timeout: 5000 });
            });
            
            let distance = null;
            if (gpsPosition && ipData.latitude) {
                distance = calculateDistance(
                    gpsPosition.coords.latitude, gpsPosition.coords.longitude,
                    ipData.latitude, ipData.longitude
                );
            }
            
            // Check if IP is from VPN/Hosting
            const isp = ipData.org || '';
            const ispLower = isp.toLowerCase();
            const isVPN = ispLower.includes('vpn') || ispLower.includes('proxy') || ispLower.includes('tor');
            const isHosting = ispLower.includes('hosting') || ispLower.includes('datacenter') || 
                            ispLower.includes('aws') || ispLower.includes('google cloud') || 
                            ispLower.includes('azure') || ispLower.includes('digitalocean');
            
            return {
                distance: distance,
                isVPN: isVPN,
                isHosting: isHosting,
                isp: isp,
                city: ipData.city,
                country: ipData.country_name,
                ip: ipData.ip
            };
            
        } catch (error) {
            return { error: 'IP check failed', isVPN: false, isHosting: false };
        }
    }
    
    // CHECK 3: VPN Detection
    async function checkForVPN() {
        try {
            // Multiple VPN detection methods
            const [ipapiResponse, ipinfoResponse] = await Promise.all([
                fetch('https://ipapi.co/json/').then(r => r.json()),
                fetch('https://ipinfo.io/json').then(r => r.json())
            ]);
            
            const isp = ipapiResponse.org || ipinfoResponse.org || '';
            const ispLower = isp.toLowerCase();
            
            // VPN/Proxy keywords
            const vpnKeywords = ['vpn', 'proxy', 'tor', 'anonymizer', 'privacy', 'hide', 'mask'];
            const hostingKeywords = ['hosting', 'datacenter', 'server', 'cloud', 'aws', 'azure', 'google', 'digitalocean', 'linode', 'vultr'];
            
            const isVPN = vpnKeywords.some(keyword => ispLower.includes(keyword));
            const isHosting = hostingKeywords.some(keyword => ispLower.includes(keyword));
            
            // Check if IP is residential (less likely to be fake GPS)
            const isResidential = !isVPN && !isHosting && 
                                (ispLower.includes('mobile') || 
                                 ispLower.includes('telecom') || 
                                 ispLower.includes('communications') ||
                                 ispLower.includes('broadband') ||
                                 isp === '');
            
            return {
                isVPN: isVPN,
                isHosting: isHosting,
                isResidential: isResidential,
                isp: isp
            };
            
        } catch (error) {
            return { isVPN: false, isHosting: false, isResidential: false, error: 'VPN check failed' };
        }
    }
    
    // CHECK 4: Coordinate Patterns
    async function checkCoordinatesPattern() {
        return new Promise((resolve) => {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    
                    // Common fake GPS patterns
                    const patterns = {
                        // Too few decimal places (common in fake GPS)
                        fewDecimals: (lat.toString().split('.')[1] || '').length < 5 || 
                                    (lon.toString().split('.')[1] || '').length < 5,
                        
                        // Popular fake locations (common coordinates in fake GPS apps)
                        isPopularFakeLocation: isPopularFakeLocation(lat, lon),
                        
                        // Exact integer or half-degree (suspicious)
                        isExactDegree: lat % 1 === 0 || lon % 1 === 0 || 
                                      lat % 0.5 === 0 || lon % 0.5 === 0,
                        
                        // Coordinates too "round"
                        isRound: isCoordinateTooRound(lat) || isCoordinateTooRound(lon)
                    };
                    
                    let isSuspicious = false;
                    let reasons = [];
                    
                    if (patterns.fewDecimals) {
                        isSuspicious = true;
                        reasons.push('Coordinates have too few decimal places');
                    }
                    
                    if (patterns.isPopularFakeLocation) {
                        isSuspicious = true;
                        reasons.push('Coordinates match known fake GPS locations');
                    }
                    
                    if (patterns.isExactDegree) {
                        isSuspicious = true;
                        reasons.push('Coordinates are exact degrees (suspicious)');
                    }
                    
                    resolve({
                        isSuspicious: isSuspicious,
                        reasons: reasons,
                        patterns: patterns,
                        coordinates: { lat: lat, lon: lon }
                    });
                },
                () => resolve({ isSuspicious: false, reasons: ['Failed to get coordinates'] }),
                { timeout: 5000 }
            );
        });
    }
    
    // Check if coordinates match popular fake locations
    function isPopularFakeLocation(lat, lon) {
        const popularFakes = [
            // Times Square, New York
            { lat: 40.7580, lon: -73.9855, radius: 0.01 },
            // Eiffel Tower, Paris
            { lat: 48.8584, lon: 2.2945, radius: 0.01 },
            // Tokyo Tower
            { lat: 35.6586, lon: 139.7454, radius: 0.01 },
            // Sydney Opera House
            { lat: -33.8568, lon: 151.2153, radius: 0.01 },
            // Popular fake GPS app defaults
            { lat: 37.4219999, lon: -122.0840575 }, // Google HQ
            { lat: 51.509865, lon: -0.118092 }, // London
            { lat: 34.052235, lon: -118.243683 }, // Los Angeles
        ];
        
        return popularFakes.some(loc => {
            const distance = calculateDistance(lat, lon, loc.lat, loc.lon);
            return distance < (loc.radius || 0.02) * 111000; // Convert degrees to meters
        });
    }
    
    // Check if coordinate is too "round"
    function isCoordinateTooRound(num) {
        const str = num.toString();
        const decimalPart = str.split('.')[1] || '';
        
        // Check for repeating patterns like 40.12345678
        if (decimalPart.length >= 4) {
            const lastFour = decimalPart.slice(-4);
            return /^(\d)\1{3}$/.test(lastFour); // Like 1111, 2222, etc.
        }
        
        return false;
    }
    
    // Analyze all checks
    function analyzeFakeGPS(checks) {
        const [gpsCheck, ipCheck, vpnCheck, coordCheck] = checks;
        
        let fakeScore = 0;
        let reasons = [];
        
        // GPS check analysis (40 points)
        if (gpsCheck.isSuspicious) {
            fakeScore += 40;
            reasons = reasons.concat(gpsCheck.reasons);
        }
        
        // IP vs GPS distance (20 points)
        if (ipCheck.distance !== null) {
            if (ipCheck.distance > 100000) { // >100km difference
                fakeScore += 20;
                reasons.push(`GPS vs IP distance: ${Math.round(ipCheck.distance/1000)}km (too large)`);
            } else if (ipCheck.distance < 1000) { // <1km (suspiciously perfect)
                fakeScore += 10;
                reasons.push('GPS and IP match perfectly (suspicious)');
            }
        }
        
        // VPN/Hosting (20 points)
        if (vpnCheck.isVPN || vpnCheck.isHosting) {
            fakeScore += 20;
            reasons.push(`VPN/Hosting detected: ${vpnCheck.isp}`);
        }
        
        // Coordinate patterns (20 points)
        if (coordCheck.isSuspicious) {
            fakeScore += 20;
            reasons = reasons.concat(coordCheck.reasons);
        }
        
        // Determine result
        const isFake = fakeScore >= 40; // 40+ points = likely fake
        
        return {
            isFake: isFake,
            fakeScore: fakeScore,
            reasons: reasons,
            gpsData: gpsCheck,
            ipData: ipCheck,
            vpnData: vpnCheck,
            coordData: coordCheck
        };
    }
    
    // Show results
    function showResults(analysis, checks) {
        const [gpsCheck, ipCheck, vpnCheck, coordCheck] = checks;
        const resultDiv = document.getElementById('result');
        
        let resultClass = 'result-real';
        let resultTitle = '‚úÖ REAL GPS DETECTED';
        let resultIcon = '‚úÖ';
        
        if (analysis.isFake) {
            resultClass = 'result-fake';
            resultTitle = 'üö® FAKE GPS DETECTED';
            resultIcon = 'üö®';
        }
        
        // Build results HTML
        let html = `
            <h3>${resultIcon} ${resultTitle}</h3>
            <p style="margin: 15px 0; font-size: 20px; font-weight: bold; color: ${analysis.isFake ? '#dc3545' : '#28a745'}">
                Fake Score: ${analysis.fakeScore}/100
            </p>
            
            <div class="check-item">
                <span>GPS Data Quality:</span>
                <span class="check-status ${gpsCheck.isSuspicious ? 'check-bad' : 'check-good'}">
                    ${gpsCheck.isSuspicious ? '‚ùå' : '‚úÖ'}
                </span>
            </div>
            
            <div class="check-item">
                <span>VPN/Proxy:</span>
                <span class="check-status ${vpnCheck.isVPN || vpnCheck.isHosting ? 'check-bad' : 'check-good'}">
                    ${vpnCheck.isVPN || vpnCheck.isHosting ? '‚ùå' : '‚úÖ'}
                </span>
            </div>
            
            <div class="check-item">
                <span>Coordinate Patterns:</span>
                <span class="check-status ${coordCheck.isSuspicious ? 'check-bad' : 'check-good'}">
                    ${coordCheck.isSuspicious ? '‚ùå' : '‚úÖ'}
                </span>
            </div>
            
            <div class="check-item">
                <span>ISP Type:</span>
                <span class="check-status ${vpnCheck.isResidential ? 'check-good' : 'check-warning'}">
                    ${vpnCheck.isResidential ? '‚úÖ Residential' : '‚ö†Ô∏è Non-Residential'}
                </span>
            </div>
        `;
        
        // Show reasons if fake
        if (analysis.reasons.length > 0) {
            html += `<div style="margin: 20px 0; padding: 15px; background: white; border-radius: 10px;">`;
            html += `<h4>üîç Findings:</h4><ul style="padding-left: 20px; margin-top: 10px;">`;
            analysis.reasons.forEach(reason => {
                html += `<li style="margin-bottom: 5px;">${reason}</li>`;
            });
            html += `</ul></div>`;
        }
        
        // Show coordinates
        if (gpsCheck.position) {
            const pos = gpsCheck.position.coords;
            const lat = pos.latitude;
            const lon = pos.longitude;
            const mapUrl = `https://maps.google.com/?q=${lat},${lon}`;
            
            html += `
                <div class="coordinates">
                    <strong>üìç Coordinates:</strong><br>
                    Latitude: ${lat.toFixed(8)}<br>
                    Longitude: ${lon.toFixed(8)}<br>
                    Accuracy: ${Math.round(pos.accuracy)} meters<br>
                    Altitude: ${pos.altitude ? Math.round(pos.altitude) + 'm' : 'No data'}<br>
                    <br>
                    <strong>üåê IP Location:</strong><br>
                    ${ipCheck.city ? `${ipCheck.city}, ${ipCheck.country}` : 'Unknown'}<br>
                    ISP: ${ipCheck.isp || 'Unknown'}
                </div>
                
                <textarea id="locationText" style="width:100%; padding:15px; border-radius:10px; margin:15px 0; font-family:monospace;" rows="4">
üìç Location Verification | ${analysis.isFake ? 'FAKE GPS DETECTED' : 'VERIFIED REAL LOCATION'}
Coordinates: ${lat.toFixed(6)}, ${lon.toFixed(6)}
Accuracy: ${Math.round(pos.accuracy)}m | Altitude: ${pos.altitude ? Math.round(pos.altitude) + 'm' : 'N/A'}
IP Location: ${ipCheck.city || 'Unknown'}, ${ipCheck.country || 'Unknown'}
ISP: ${ipCheck.isp || 'Unknown'}
Time: ${new Date().toLocaleString()}
Map: ${mapUrl}
                </textarea>
                
                <button class="copy-btn" onclick="copyToClipboard()">üìã Copy to Rocket.Chat</button>
            `;
        }
        
        resultDiv.innerHTML = html;
        resultDiv.className = `result ${resultClass}`;
        resultDiv.style.display = 'block';
        
        // Scroll to results
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Utility functions
    function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371000;
        const œÜ1 = lat1 * Math.PI/180;
        const œÜ2 = lat2 * Math.PI/180;
        const ŒîœÜ = (lat2-lat1) * Math.PI/180;
        const ŒîŒª = (lon2-lon1) * Math.PI/180;
        
        const a = Math.sin(ŒîœÜ/2)*Math.sin(ŒîœÜ/2) +
                Math.cos(œÜ1)*Math.cos(œÜ2)*
                Math.sin(ŒîŒª/2)*Math.sin(ŒîŒª/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        
        return R * c;
    }
    
    function copyToClipboard() {
        const textarea = document.getElementById('locationText');
        textarea.select();
        document.execCommand('copy');
        
        const btn = event.target;
        const original = btn.innerHTML;
        btn.innerHTML = '‚úÖ Copied!';
        setTimeout(() => btn.innerHTML = original, 2000);
    }
    
    // Initialize
    window.addEventListener('load', () => {
        // Auto-start on mobile for convenience
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        if (isMobile) {
            document.querySelector('.warning').innerHTML += 
                '<p style="margin-top:10px;"><strong>üì± Mobile detected:</strong> Ready for quick verification</p>';
        }
    });
    </script>
</body>
</html>
