<!DOCTYPE html>
<html>
<head>
    <title>üìç Military-Grade GPS Accuracy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            min-height: 100vh;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2D8CFF, #0066CC);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
        }
        .header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        .content {
            padding: 25px;
        }
        .accuracy-meter {
            background: linear-gradient(90deg, #ff4444, #ffbb33, #00C851);
            height: 8px;
            border-radius: 4px;
            margin: 25px 0;
            position: relative;
        }
        .accuracy-marker {
            position: absolute;
            top: -5px;
            width: 3px;
            height: 18px;
            background: #333;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }
        .btn {
            background: linear-gradient(135deg, #2D8CFF, #0066CC);
            color: white;
            border: none;
            padding: 18px 30px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 15px;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(42, 139, 242, 0.4);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(42, 139, 242, 0.5);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .status {
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            font-weight: 500;
        }
        .status-good {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }
        .status-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid #ffc107;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid #17a2b8;
        }
        .result-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border: 2px solid #2D8CFF;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 12px;
            background: white;
            border-radius: 10px;
            border: 1px solid #dee2e6;
            align-items: center;
        }
        .metric-value {
            font-weight: 700;
            font-size: 18px;
            color: #2D8CFF;
        }
        .accuracy-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        .badge-excellent { background: #28a745; color: white; }
        .badge-good { background: #17a2b8; color: white; }
        .badge-fair { background: #ffc107; color: #212529; }
        .badge-poor { background: #dc3545; color: white; }
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin: 15px 0;
            resize: vertical;
            min-height: 120px;
        }
        .tip-box {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            border-left: 5px solid #2D8CFF;
        }
        .tip-box h3 {
            margin-top: 0;
            color: #2D8CFF;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìç MILITARY-GRADE GPS ACCURACY</h1>
            <p>Get under 5 meters accuracy with anti-fake GPS detection</p>
        </div>
        
        <div class="content">
            <!-- Accuracy Meter -->
            <div class="accuracy-meter">
                <div class="accuracy-marker" style="left: 0%;"></div>
                <div class="accuracy-marker" style="left: 25%;"></div>
                <div class="accuracy-marker" style="left: 50%;"></div>
                <div class="accuracy-marker" style="left: 75%;"></div>
                <div class="accuracy-marker" style="left: 100%;"></div>
            </div>
            <div class="meter-labels">
                <span>Poor (>50m)</span>
                <span>Fair (20-50m)</span>
                <span>Good (5-20m)</span>
                <span>Excellent (1-5m)</span>
                <span>Military (<1m)</span>
            </div>
            
            <!-- Tips for High Accuracy -->
            <div class="tip-box">
                <h3>üéØ FOR BEST ACCURACY:</h3>
                <ol>
                    <li><strong>Go OUTSIDE</strong> (clear sky view)</li>
                    <li><strong>Enable WiFi</strong> even if not connected</li>
                    <li><strong>Enable Mobile Data</strong></li>
                    <li><strong>Hold phone flat</strong> (screen facing sky)</li>
                    <li><strong>Wait 30 seconds</strong> after starting</li>
                </ol>
                <p style="margin-top: 10px; font-size: 14px; color: #666;">
                    üì± <strong>On iPhone:</strong> Settings ‚Üí Privacy ‚Üí Location Services ‚Üí Enable
                    <br>üì± <strong>On Android:</strong> Settings ‚Üí Location ‚Üí High Accuracy Mode
                </p>
            </div>
            
            <!-- Main Button -->
            <button class="btn" onclick="startHighAccuracyScan()">
                üéØ START HIGH-ACCURACY SCAN
            </button>
            
            <!-- Status Display -->
            <div id="status"></div>
            
            <!-- Results -->
            <div id="results"></div>
        </div>
    </div>

    <script>
    // Global variables
    let bestAccuracy = Infinity;
    let bestPosition = null;
    let watchId = null;
    let scanStartTime = null;
    let isScanning = false;
    
    // Start high accuracy scan
    async function startHighAccuracyScan() {
        if (isScanning) return;
        
        isScanning = true;
        bestAccuracy = Infinity;
        bestPosition = null;
        scanStartTime = Date.now();
        
        // Update UI
        const btn = document.querySelector('.btn');
        btn.innerHTML = '<span class="loading"></span> SCANNING FOR HIGH ACCURACY...';
        btn.disabled = true;
        
        showStatus('üéØ Starting high-accuracy GPS scan...', 'info');
        showStatus('üìç Move to OPEN AREA with clear sky view', 'warning');
        showStatus('üì° Using GPS + WiFi + Mobile Data for maximum accuracy', 'info');
        
        // Clear previous results
        document.getElementById('results').innerHTML = '';
        
        // Start watching position with highest accuracy settings
        if (watchId !== null) {
            navigator.geolocation.clearWatch(watchId);
        }
        
        // AGGRESSIVE accuracy settings
        const options = {
            enableHighAccuracy: true,     // Force GPS chip usage
            timeout: 60000,               // 60 second timeout
            maximumAge: 0,                // No cached positions
        };
        
        watchId = navigator.geolocation.watchPosition(
            // Success callback
            (position) => handlePositionUpdate(position),
            // Error callback
            (error) => handlePositionError(error),
            options
        );
        
        // Show progress updates
        updateProgress();
    }
    
    // Handle position updates
    function handlePositionUpdate(position) {
        const accuracy = position.coords.accuracy;
        const elapsed = (Date.now() - scanStartTime) / 1000;
        
        // Track best accuracy
        if (accuracy < bestAccuracy) {
            bestAccuracy = accuracy;
            bestPosition = position;
            
            // Update status with current best
            showStatus(`üéØ Best accuracy: ${Math.round(accuracy)} meters (${elapsed.toFixed(0)}s)`, 
                      getAccuracyStatus(accuracy));
            
            // Update accuracy meter
            updateAccuracyMeter(accuracy);
            
            // If we get under 5 meters, consider stopping
            if (accuracy <= 5) {
                showStatus('‚úÖ TARGET ACHIEVED: Under 5 meters accuracy!', 'good');
                
                // Continue for a bit more to see if we can get even better
                if (accuracy <= 2) {
                    setTimeout(() => {
                        finishScan(true);
                    }, 5000); // Wait 5 more seconds for possible improvement
                }
            }
        }
        
        // Auto-stop conditions
        if (elapsed >= 90) { // Max 90 seconds
            finishScan(bestAccuracy <= 20);
        } else if (accuracy <= 1 && elapsed >= 10) { // Got military-grade accuracy
            finishScan(true);
        }
    }
    
    // Handle position errors
    function handlePositionError(error) {
        let message = 'GPS Error: ';
        switch(error.code) {
            case error.PERMISSION_DENIED:
                message = 'üö´ Location access denied. Please enable location services.';
                break;
            case error.POSITION_UNAVAILABLE:
                message = '‚ö†Ô∏è GPS signal weak. Go OUTSIDE with clear sky view.';
                break;
            case error.TIMEOUT:
                message = '‚è∞ GPS timeout. Make sure high accuracy mode is enabled.';
                break;
        }
        showStatus(message, 'error');
        finishScan(false);
    }
    
    // Update progress indicator
    function updateProgress() {
        if (!isScanning) return;
        
        const elapsed = (Date.now() - scanStartTime) / 1000;
        
        // Update status every 5 seconds
        if (Math.floor(elapsed) % 5 === 0 && elapsed < 30) {
            showStatus(`‚è±Ô∏è Scanning... ${elapsed.toFixed(0)}s elapsed`, 'info');
        }
        
        // Auto-update
        setTimeout(updateProgress, 1000);
    }
    
    // Finish the scan
    function finishScan(success) {
        if (!isScanning) return;
        
        isScanning = false;
        
        if (watchId !== null) {
            navigator.geolocation.clearWatch(watchId);
            watchId = null;
        }
        
        // Update button
        const btn = document.querySelector('.btn');
        btn.innerHTML = 'üéØ START HIGH-ACCURACY SCAN';
        btn.disabled = false;
        
        if (success && bestPosition) {
            // Analyze and display results
            analyzeAndDisplayResults(bestPosition);
        } else {
            showStatus('‚ùå Failed to achieve high accuracy. Try going OUTSIDE.', 'error');
            showAccuracyTips();
        }
    }
    
    // Analyze and display results
    function analyzeAndDisplayResults(position) {
        const accuracy = position.coords.accuracy;
        const elapsed = (Date.now() - scanStartTime) / 1000;
        
        // Get accuracy badge
        const accuracyBadge = getAccuracyBadge(accuracy);
        
        // Check for fake GPS indicators
        const isFake = checkForFakeGPS(position);
        
        // Generate results HTML
        let resultsHTML = `
            <div class="result-box">
                <h2 style="margin-top: 0; color: #2D8CFF;">üéØ SCAN COMPLETE</h2>
                
                <div class="metric">
                    <span>Final Accuracy:</span>
                    <div>
                        <span class="metric-value">${Math.round(accuracy)} meters</span>
                        <span class="accuracy-badge ${accuracyBadge.class}">${accuracyBadge.text}</span>
                    </div>
                </div>
                
                <div class="metric">
                    <span>Scan Time:</span>
                    <span class="metric-value">${elapsed.toFixed(1)} seconds</span>
                </div>
                
                <div class="metric">
                    <span>Altitude:</span>
                    <span class="metric-value">${position.coords.altitude ? Math.round(position.coords.altitude) + 'm' : 'N/A'}</span>
                </div>
                
                <div class="metric">
                    <span>Speed:</span>
                    <span class="metric-value">${position.coords.speed ? (position.coords.speed * 3.6).toFixed(1) + ' km/h' : '0 km/h'}</span>
                </div>
                
                <div class="metric">
                    <span>Satellites (est.):</span>
                    <span class="metric-value">${estimateSatellites(accuracy)}</span>
                </div>
        `;
        
        // Fake GPS detection
        if (isFake.detected) {
            resultsHTML += `
                <div style="margin: 20px 0; padding: 15px; background: #f8d7da; border-radius: 10px; color: #721c24;">
                    <h3 style="margin-top: 0; color: #dc3545;">üö® FAKE GPS DETECTED!</h3>
                    <p>${isFake.reason}</p>
                    <p><strong>Accuracy too perfect for normal GPS.</strong></p>
                </div>
            `;
        } else if (accuracy <= 5) {
            resultsHTML += `
                <div style="margin: 20px 0; padding: 15px; background: #d4edda; border-radius: 10px; color: #155724;">
                    <h3 style="margin-top: 0; color: #28a745;">‚úÖ GENUINE HIGH ACCURACY GPS</h3>
                    <p>This accuracy level is only achievable with real GPS signal.</p>
                </div>
            `;
        }
        
        // Coordinates
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const mapUrl = `https://www.google.com/maps?q=${lat},${lon}&z=18`;
        
        resultsHTML += `
                <h3>üìç Coordinates:</h3>
                <div style="background: white; padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <p><strong>Latitude:</strong> ${lat.toFixed(8)}</p>
                    <p><strong>Longitude:</strong> ${lon.toFixed(8)}</p>
                    <p><a href="${mapUrl}" target="_blank" style="color: #2D8CFF; text-decoration: none;">
                        üó∫Ô∏è View on Google Maps (Zoomed)
                    </a></p>
                </div>
        `;
        
        // Copy to clipboard section
        const timestamp = new Date().toISOString();
        const message = `üìç MILITARY-GRADE GPS VERIFICATION
Accuracy: ${Math.round(accuracy)} meters (${accuracyBadge.text})
Latitude: ${lat.toFixed(8)}
Longitude: ${lon.toFixed(8)}
Altitude: ${position.coords.altitude ? Math.round(position.coords.altitude) + 'm' : 'N/A'}
Time: ${new Date().toLocaleString()}
Map: ${mapUrl}
${isFake.detected ? 'üö® WARNING: FAKE GPS DETECTED' : '‚úÖ VERIFIED: Genuine GPS Signal'}`;
        
        resultsHTML += `
                <h3>üìã Copy for Rocket.Chat:</h3>
                <textarea id="locationText">${message}</textarea>
                <button class="btn" onclick="copyToClipboard()">üìã COPY VERIFIED LOCATION</button>
                
                ${accuracy > 5 ? `
                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px;">
                    <h4>üéØ Need better accuracy?</h4>
                    <p>For under 5 meters:</p>
                    <ul>
                        <li>Move to OPEN FIELD with no buildings</li>
                        <li>Hold phone FLAT (screen facing sky)</li>
                        <li>Wait 1-2 minutes for GPS to stabilize</li>
                        <li>Enable WiFi (even if not connected)</li>
                    </ul>
                </div>
                ` : ''}
            </div>
        `;
        
        document.getElementById('results').innerHTML = resultsHTML;
        
        // Scroll to results
        document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    }
    
    // Check for fake GPS indicators
    function checkForFakeGPS(position) {
        const accuracy = position.coords.accuracy;
        
        // Too perfect accuracy (fake GPS apps often give 0-1m)
        if (accuracy < 1 && !position.coords.altitude && !position.coords.speed) {
            return {
                detected: true,
                reason: "Accuracy less than 1 meter with no altitude/speed data is highly suspicious."
            };
        }
        
        // Perfect round numbers (common in fake GPS)
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const latDecimals = lat.toString().split('.')[1] || '';
        const lonDecimals = lon.toString().split('.')[1] || '';
        
        if (latDecimals.length < 5 || lonDecimals.length < 5) {
            return {
                detected: true,
                reason: "Coordinates have too few decimal places (common in fake GPS)."
            };
        }
        
        // Altitude exactly 0 (common in fake GPS)
        if (position.coords.altitude === 0 && accuracy < 5) {
            return {
                detected: true,
                reason: "Altitude exactly 0 with high accuracy is suspicious."
            };
        }
        
        return { detected: false, reason: '' };
    }
    
    // Get accuracy status
    function getAccuracyStatus(accuracy) {
        if (accuracy <= 1) return 'good';
        if (accuracy <= 5) return 'good';
        if (accuracy <= 20) return 'warning';
        return 'error';
    }
    
    // Get accuracy badge
    function getAccuracyBadge(accuracy) {
        if (accuracy <= 1) return { class: 'badge-excellent', text: 'MILITARY GRADE' };
        if (accuracy <= 3) return { class: 'badge-excellent', text: 'EXCELLENT' };
        if (accuracy <= 5) return { class: 'badge-excellent', text: 'VERY GOOD' };
        if (accuracy <= 10) return { class: 'badge-good', text: 'GOOD' };
        if (accuracy <= 20) return { class: 'badge-fair', text: 'FAIR' };
        return { class: 'badge-poor', text: 'NEEDS IMPROVEMENT' };
    }
    
    // Estimate satellites based on accuracy
    function estimateSatellites(accuracy) {
        if (accuracy <= 1) return '10+ (Excellent)';
        if (accuracy <= 3) return '7-9 (Very Good)';
        if (accuracy <= 5) return '5-7 (Good)';
        if (accuracy <= 10) return '4-5 (Fair)';
        return '1-3 (Poor)';
    }
    
    // Update accuracy meter
    function updateAccuracyMeter(accuracy) {
        const meter = document.querySelector('.accuracy-meter');
        
        // Calculate position (0-100%)
        let position = 0;
        if (accuracy >= 50) position = 0;
        else if (accuracy >= 20) position = 25;
        else if (accuracy >= 5) position = 50;
        else if (accuracy >= 1) position = 75;
        else position = 100;
        
        // Create marker
        const existingMarker = meter.querySelector('.current-marker');
        if (existingMarker) existingMarker.remove();
        
        const marker = document.createElement('div');
        marker.className = 'current-marker';
        marker.style.position = 'absolute';
        marker.style.top = '-8px';
        marker.style.left = position + '%';
        marker.style.width = '6px';
        marker.style.height = '24px';
        marker.style.background = '#2D8CFF';
        marker.style.borderRadius = '3px';
        marker.style.boxShadow = '0 0 10px rgba(42, 139, 242, 0.8)';
        
        meter.appendChild(marker);
    }
    
    // Show accuracy tips
    function showAccuracyTips() {
        const tips = `
            <div class="tip-box">
                <h3>üéØ HOW TO GET UNDER 5 METERS:</h3>
                <ol>
                    <li><strong>GO OUTSIDE</strong> - No roofs, no tall buildings</li>
                    <li><strong>Enable HIGH ACCURACY mode</strong> in phone settings</li>
                    <li><strong>Turn on WiFi</strong> (helps even if not connected)</li>
                    <li><strong>Enable Mobile Data</strong></li>
                    <li><strong>Hold phone FLAT</strong> - screen facing the sky</li>
                    <li><strong>Wait 1-2 minutes</strong> for GPS to stabilize</li>
                    <li><strong>Avoid moving</strong> during scan</li>
                </ol>
                <p><strong>iPhone:</strong> Settings ‚Üí Privacy ‚Üí Location Services ‚Üí ON</p>
                <p><strong>Android:</strong> Settings ‚Üí Location ‚Üí Mode ‚Üí High Accuracy</p>
            </div>
        `;
        
        document.getElementById('results').innerHTML = tips;
    }
    
    // Show status message
    function showStatus(message, type) {
        const statusDiv = document.getElementById('status');
        const statusElement = document.createElement('div');
        statusElement.className = `status status-${type}`;
        statusElement.innerHTML = message;
        
        // Add to top
        statusDiv.insertBefore(statusElement, statusDiv.firstChild);
        
        // Auto-remove old messages (keep last 5)
        const messages = statusDiv.querySelectorAll('.status');
        if (messages.length > 5) {
            messages[messages.length - 1].remove();
        }
    }
    
    // Copy to clipboard
    function copyToClipboard() {
        const textarea = document.getElementById('locationText');
        textarea.select();
        document.execCommand('copy');
        
        const btn = event.target;
        const original = btn.innerHTML;
        btn.innerHTML = '‚úÖ COPIED!';
        btn.style.background = 'linear-gradient(135deg, #28a745, #1e7e34)';
        
        setTimeout(() => {
            btn.innerHTML = original;
            btn.style.background = 'linear-gradient(135deg, #2D8CFF, #0066CC)';
        }, 2000);
    }
    
    // Initialize
    window.addEventListener('load', () => {
        // Check if geolocation is supported
        if (!navigator.geolocation) {
            alert('‚ùå Your browser does not support GPS. Please use Chrome on Android or Safari on iPhone.');
        }
        
        // Detect device
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        if (!isMobile) {
            showStatus('‚ö†Ô∏è For best results, use a MOBILE PHONE with real GPS chip', 'warning');
        }
    });
    </script>
</body>
</html>
